<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Leela Bazar</title>
  <meta name="description" content="Leela Bazar – Play Smart & Track Your Game Stats Easily." />
  <meta name="keywords" content="Leela Bazar, games, tracking, stats, online game" />
  <meta name="author" content="Leela Bazar Team" />
  <meta property="og:title" content="Leela Bazar" />
  <meta property="og:description" content="Play Smart. Track Smarter. Leela Bazar PWA." />
  <meta property="og:image" content="Logo.jpg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/" />
  <link rel="icon" type="image/png" sizes="192x192" href="Logo.jpg" />
  <link rel="apple-touch-icon" href="Logo.jpg">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FED7AA" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Leela Bazar">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script type="module"
    src="firebaseicsjiwhiudnjscniqueh8e28e28d82hd82h82h22h8dwdhsujvskaie3nejf9wu2ewidj9wi02e3u48u5tugr9uw9d3hrujfe.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("service-worker.js")
          .then(() => console.log("Service Worker Registered"));
      });
    }
  </script>
  <script src="Blocked.js"></script>
</head>

<body class="bg-gray-100">
  <h1 id="loggedUserFName" class="hidden"></h1>

  <script>setTimeout(() => {

      const name = document.getElementById('loggedUserFName').innerText;
      const mail = document.getElementById('loggedUserEmail').innerText;
      if (name == "" || mail == "") {
        window.location.href = "index.html";
      }

    }, 4000);


  </script>
  <div id="page-loader"
    class="fixed top-0 left-0 w-full h-full inset-1 bg-black bg-opacity-50 flex items-center justify-center z-50  transition-opacity duration-500 hidden">
    <div class="w-16 h-16 border-8 border-white border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- HEADER -->
  <div class="bg-orange-200 z-40 left-0 w-full shadow-md rounded-b-3xl">
    <div class="p-5">

      <div onclick="window.location.href='index.html'" class="flex justify-between items-center">
        <div id="openSidebar" class="flex items-center gap-3 cursor-pointer">
          <img src="Logo.jpg" alt="Leela Bazar" class="w-11 h-11 rounded-full shadow-md" />
          <p id="loggedUserEmail" class="font-extrabold text-black text-2xl">Leela Bazar</p>
        </div>

        <div class="flex items-center gap-5 text-gray-900 text-2xl">
          <i id="translateToggle" 
   class="fa-solid fa-language text-gray-800 text-3xl cursor-pointer  transition   top-4 right-4 z-50" 
   title="Toggle Language"></i>

<!-- Google Translate hidden div -->
<div id="google_translate_element" style="display:none;"></div>

          <i onclick="window.location.href='App.html'" class="fa-solid fa-mobile hover:text-blue-600 transition"></i>
        </div>
      </div>

      <div class="mt-4 ">
        <div class="bg-orange-100 rounded-2xl flex items-center px-4 py-3 shadow-inner">
          <i class="fa-solid fa-search text-gray-500 mr-3"></i>
          <input type="text" placeholder="Search Your Data ..."
            class="w-full bg-transparent outline-none text-gray-700 placeholder-gray-500" />
        </div>
      </div>

    </div>
  </div>

  <!-- TABLE -->
  <div class="mx-2">
    <div class="bg-white py-2 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4 mx-3 flex justify-between">
        <p>Chart Sheet </p>
        <p class="mr-1">Update</p>
      </h2>
      <div id="recordsBody">
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>

        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
        <div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between animate-pulse">
          <div class="space-y-2">
            <div class="h-6 w-16 bg-gray-300 rounded"></div>
            <div class="h-5 w-24 bg-pink-300 rounded"></div>
          </div>
          <div class="h-8 w-20 bg-blue-900 rounded opacity-50"></div>
        </div>
      </div>

    </div>
  </div>
  </div>

  <!-- UPDATE BOX -->
  <div id="updatebox" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-40">
    <div class="fixed bottom-0 left-0 w-full bg-white rounded-t-3xl px-3 py-8 shadow-lg ">

      <div class="flex justify-between text-center">
        <div class="text-left">
          <h2 class="text-2xl font-bold">Update Data</h2>
          <p class="text-gray-600 mt-1">Chart Sheet</p>
        </div>
        <!-- Angle down -->
        <div onclick="showUpdateBox()"
          class="w-12 h-12 bg-gray-200 rounded-full border border-black flex items-center justify-center cursor-pointer hover:bg-gray-300 transition">
          <i class="fa-solid fa-angle-down text-black text-lg"></i>
        </div>
      </div>

      <form id="crudForm" class="grid grid-cols-1 mt-4 md:grid-cols-2 gap-4">

        <div>
          <select name="Id" title="Select Tittle"
            class="border border-black p-4 w-full font-bold text-black focus:outline-none focus:ring-0 rounded">
            <option value="">Select Applicant</option>
            <option value="Golden">Golden</option>
            <option value="Final">Final</option>
            <option value="MORNING SYNDICATE">MORNING SYNDICATE</option>
            <option value="KALYAN MORNING">KALYAN MORNING</option>
            <option value="SYNDICATE NIGHT">SYNDICATE NIGHT</option>
            <option value="LEELA BAZAR">LEELA BAZAR</option>
            <option value="RAJDHANI NIGHT">RAJDHANI NIGHT</option>
          </select>
          <br>
          <select name="day" title="Select Days"
            class="border border-black mt-2 p-4 w-full font-bold text-black focus:outline-none focus:ring-0 rounded">
            <option value="">-- Select Day --</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
            <option value="Saturday">Saturday</option>
            <option value="Sunday">Sunday</option>
          </select>

          <input type="text" name="Category" value="General"
            class="border hidden p-2 font-bold rounded focus:outline-none focus:ring-0" />
        </div>

        <div class="flex gap-3">
          <input type="date" name="Date" placeholder="Date"
            class="border p-3 text-sm rounded border-black w-1/3  font-bold focus:outline-none focus:ring-0" />
          <input type="time" name="Time" placeholder="Time Start"
            class="border p-3 rounded w-1/3 border-black  font-bold focus:outline-none focus:ring-0" />
          <input type="time" name="End" placeholder="Time End"
            class="border p-3 rounded w-1/3 border-black  font-bold focus:outline-none focus:ring-0" />

        </div>

        <div class="flex gap-3">
          <input type="number" name="Jodi" placeholder="Jodi"
            class="border p-4 rounded border-black w-1/3  font-bold focus:outline-none focus:ring-0" />
          <input type="number" name="Marks" placeholder="Marks"
            class="border p-4 rounded w-1/3 border-black  font-bold focus:outline-none focus:ring-0" />
          <input type="number" name="Pennel" placeholder="Pennel"
            class="border p-4 rounded w-1/3 border-black  font-bold focus:outline-none focus:ring-0" />
        </div>

        <div class="flex">
          <button type="button" id="updateBtn" onclick="showLoader();"
            class="bg-blue-900 w-full md:w-[48.4vw] text-white py-4 rounded-full text-lg font-bold mt-8 shadow-md hover:bg-blue-700 transition">
            UPDATE
          </button> <button type="button" id="createBtn" onclick="showLoader();"
            class="bg-blue-900 w-full md:w-[48.4vw] text-white py-4 rounded-full text-lg font-bold mt-8 shadow-md hover:bg-blue-700 transition">
            CREATE
          </button>
        </div>
      </form>
    </div>
  </div>
  <script>
    function showUpdateBox() {
      const box = document.getElementById('updatebox');
      box.classList.add('hidden');
    }

    function showLoader(displayTime = 3000) {
      const loader = document.getElementById('page-loader');
      loader.style.display = 'flex';
      loader.classList.remove('opacity-0');

      setTimeout(() => {
        loader.classList.add('opacity-0');
        setTimeout(() => {
          loader.style.display = 'none';
        }, 500); // Fade duration
      }, displayTime); // Loader display duration
    }

    const scriptURL = "https://script.google.com/macros/s/AKfycbyW6iFWJpgLR-oogi_GysEp_RXph9d9vaQ2idlMgsQQVAg3ee_XeKuqyI_HDyaqnwlG/exec";

    function getCurrentDateTime() {
      const now = new Date();
      return {
        date: now.toISOString().split("T")[0],
        time: now.toTimeString().slice(0, 5)
      };
    }

    // LOAD RECORDS
    async function fetchRecords() {
      showLoader(500); // optional brief loader
      try {
        const res = await fetch(`${scriptURL}?action=read`);
        const data = await res.json();
        const body = document.getElementById("recordsBody");
        body.innerHTML = "";

        // Keep track of already rendered Ids
        const renderedIds = new Set();

        data.records.reverse().forEach(r => {
          if (!renderedIds.has(r.Id)) {
            renderedIds.add(r.Id);

            const row = document.createElement("div");
            row.innerHTML = `
<div class="p-3 bg-orange-100 shadow rounded-lg border mb-3 flex justify-between">
  <div>
    <h2 class="font-bold text-lg text-gray-700">${r.Id}</h2>
    <p class="text-pink-600 font-extrabold text-lg">${r.Jodi || ""}${r.Marks ? "-" + r.Marks : ""}${r.Pennel ? "-" + r.Pennel : ""}</p>
  </div>

  <button onclick="fillForm('${r.Id}')" 
          class="bg-blue-900 text-white px-4 h-8 rounded hover:bg-yellow-600">
    Update
  </button>
</div>`;
            body.appendChild(row);
          }
        });


      } catch (err) {
        console.error("Error fetching records:", err);
      }
    }

    // FILL FORM (open update box)
    async function fillForm(Id) {
      showLoader();
      try {
        const res = await fetch(`${scriptURL}?action=read`);
        const data = await res.json();
        const record = data.records.find(r => r.Id == Id);
        if (record) {
          const form = document.getElementById("crudForm");
          Object.keys(record).forEach(key => {
            if (form[key]) form[key].value = record[key];
          });
          document.getElementById("updatebox").classList.remove("hidden");
        }
      } catch (err) {
        console.error("Error filling form:", err);
      }
    }

    // SUBMIT UPDATE
    document.getElementById("updateBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      const form = document.getElementById("crudForm");
      const fd = Object.fromEntries(new FormData(form));

      if (!fd.Id) {
        alert("Name is required");
        return;
      }

      showLoader();
      try {
        await fetch(`${scriptURL}?action=update&${new URLSearchParams(fd).toString()}`);
        document.getElementById("updatebox").classList.add("hidden");
        form.reset();
        fetchRecords();
      } catch (err) {
        console.error("Error updating record:", err);
        alert("Update failed.");
      }
    });

    // ADD / CREATE RECORD
    document.getElementById("createBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      const form = document.getElementById("crudForm");
      const fd = Object.fromEntries(new FormData(form));

      if (!fd.Id) {
        alert("Name is required");
        return;
      }

      showLoader();
      try {
        const res = await fetch(`${scriptURL}?action=create&${new URLSearchParams(fd).toString()}`);
        const result = await res.json();

        if (result.status === "success") {


          form.reset();
          fetchRecords();
        } else {


        }
      } catch (err) {
        console.error("Error creating record:", err);


      }
    });

    // INITIAL LOAD
    fetchRecords();
  </script>

</body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
  import {
    getFirestore,
    getDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

  // ✅ Your Firebase config (USE YOUR OWN VALUES HERE)
  const firebaseConfig = {
    apiKey: "AIzaSyAKN5GR18VTFrKNgVG7FenD4aSTX3Q2PbA",
    authDomain: "gift-zone-project.firebaseapp.com",
    projectId: "gift-zone-project",
    storageBucket: "gift-zone-project.appspot.com",
    messagingSenderId: "806465456032",
    appId: "1:806465456032:web:becf8988a6dfabe43646c5",
    measurementId: "G-1ZLMWBP61Y",
  };

  // ✅ Initialize Firebase services
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ✅ On Auth Change: fetch and show user data
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const loggedInUserId = localStorage.getItem("loggedInUserId");
      if (!loggedInUserId) {
        console.log("User ID not found in local storage.");
        return;
      }

      const docRef = doc(db, "users", loggedInUserId);
      getDoc(docRef)
        .then((docSnap) => {
          if (docSnap.exists()) {
            const userData = docSnap.data();
            let filt = document.getElementById("loggedUserFName").innerText = userData.firstName || "N/A";
            document.getElementById("loggedUserEmail").innerText = userData.email || "N/A";
            const lNameElement = document.getElementById("loggedUserLName");
            if (userData.lastName) {
              lNameElement.innerText = userData.lastName;
            } else {
              lNameElement.innerText = "-";
            }
          } else {
            console.log("No user document found in Firestore.");
          }
        })
        .catch((error) => {
          console.error("Error fetching user data:", error);
        });
    } else {
      console.log("User not signed in.");
      window.location.href = "index.html"; // Redirect to login
    }
  });

  // ✅ Logout
  const logoutButton = document.getElementById("logout");
  logoutButton.addEventListener("click", () => {
    localStorage.removeItem("loggedInUserId");
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        console.error("Error signing out:", error);
      });
  });

</script>
<script>
  let currentLang = 'en'; // track current language
  let gtLoaded = false;

  const toggleBtn = document.getElementById("translateToggle");

  toggleBtn.addEventListener("click", () => {
    if (!gtLoaded) {
      // Load Google Translate script dynamically
      const gtScript = document.createElement("script");
      gtScript.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
      document.body.appendChild(gtScript);

      window.googleTranslateElementInit = function() {
        new google.translate.TranslateElement({
          pageLanguage: 'en',
          includedLanguages: 'en,hi',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');

        gtLoaded = true;
        toggleLanguage(); // Switch to Hindi on first click
      }
    } else {
      toggleLanguage();
    }
  });

  function toggleLanguage() {
    const select = document.querySelector(".goog-te-combo");
    if (!select) return;

    if (currentLang === 'en') {
      select.value = 'hi'; // Translate to Hindi
      currentLang = 'hi';
    } else {
      select.value = 'en'; // Translate back to English
      currentLang = 'en';
    }
    select.dispatchEvent(new Event('change'));
  }
</script>

</html>